<app-navbar></app-navbar>
 
<div class="schedule-management-container">
    <div class="header">
        <h1>Schedule Management üìÖ</h1>
        <p>Manage flight schedules and time slots</p>
    </div>
 
    <div class="action-bar">
        <div class="search-box">
            <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onFilterChange()"
                placeholder="Search by airline, source, or destination..." />
            <span class="search-icon">üîç</span>
        </div>
 
        <select class="filter-select" [(ngModel)]="filterStatus" (ngModelChange)="onFilterChange()">
            <option value="ALL">All Schedules</option>
            <option value="UPCOMING">Upcoming Only</option>
            <option value="PAST">Past Only</option>
        </select>
 
        <button class="btn-add" (click)="openAddModal()">
            ‚ûï Add New Schedule
        </button>
    </div>
 
    <div class="stats-bar">
        <div class="stat">
            <span class="stat-label">Total:</span>
            <span class="stat-value">{{ getScheduleStats().total }}</span>
        </div>
        <div class="stat upcoming">
            <span class="stat-label">Upcoming:</span>
            <span class="stat-value">{{ getScheduleStats().upcoming }}</span>
        </div>
        <div class="stat past">
            <span class="stat-label">Past:</span>
            <span class="stat-value">{{ getScheduleStats().past }}</span>
        </div>
        <div class="stat">
            <span class="stat-label">Showing:</span>
            <span class="stat-value">{{ getScheduleStats().filtered }}</span>
        </div>
    </div>
 
    <div *ngIf="loading" class="loading">Loading schedules...</div>
 
    <div *ngIf="error && !loading && !showModal" class="error-message">{{ error }}</div>
 
    <div *ngIf="!loading && filteredSchedules.length === 0" class="no-data">
        <p>No schedules found.</p>
    </div>
 
    <div *ngIf="!loading && filteredSchedules.length > 0" class="schedules-list">
        <div *ngFor="let schedule of filteredSchedules" class="schedule-card">
            <div class="card-header">
                <div class="flight-info">
                    <h3>{{ schedule.flight?.airline }}</h3>
                    <p class="route">
                        {{ schedule.flight?.source }} ‚Üí {{ schedule.flight?.destination }}
                    </p>
                </div>
                <div class="status-badges">
                    <span *ngIf="isUpcoming(schedule.departure_time)" class="badge upcoming">
                        Upcoming
                    </span>
                    <span *ngIf="!isUpcoming(schedule.departure_time)" class="badge past">
                        Past
                    </span>
                    <span class="badge seats">
                        {{ schedule.available_seats }} seats
                    </span>
                </div>
            </div>
 
            <div class="card-body">
                <div class="time-section">
                    <div class="time-block">
                        <span class="time-label">Departure</span>
                        <span class="time-value">{{ formatDateTime(schedule.departure_time) }}</span>
                    </div>
                    <div class="duration">
                        <span class="duration-icon">‚è±Ô∏è</span>
                        <span>{{ getDuration(schedule.departure_time, schedule.arrival_time) }}</span>
                    </div>
                    <div class="time-block">
                        <span class="time-label">Arrival</span>
                        <span class="time-value">{{ formatDateTime(schedule.arrival_time) }}</span>
                    </div>
                </div>
 
                <div class="schedule-details">
                    <div class="detail-item">
                        <span class="label">Total Seats:</span>
                        <span class="value">{{ schedule.flight?.total_seats }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Available:</span>
                        <span class="value">{{ schedule.available_seats }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Booked:</span>
                        <span class="value">{{ schedule.flight?.total_seats - schedule.available_seats }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="label">Price:</span>
                        <span class="value">{{ schedule.price }}</span>
                    </div>
                </div>
            </div>
 
            <div class="card-actions">
                <button class="btn-edit" (click)="openEditModal(schedule)">
                    ‚úèÔ∏è Edit
                </button>
                <button class="btn-delete" (click)="deleteSchedule(schedule._id, schedule.flight?.airline)">
                    üóëÔ∏è Delete
                </button>
            </div>
        </div>
    </div>
 
    <!-- Add/Edit Modal -->
    <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>{{ isEditMode ? 'Edit Schedule' : 'Add New Schedule' }}</h2>
                <button class="close-btn" (click)="closeModal()">√ó</button>
            </div>
 
            <form (ngSubmit)="saveSchedule()" #scheduleForm="ngForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="flight">Select Flight *</label>
                        <select id="flight" name="flight" [(ngModel)]="currentSchedule.flight" required
                            [disabled]="modalLoading">
                            <option value="">-- Select a flight --</option>
                            <option *ngFor="let flight of flights" [value]="flight._id">
                                {{ flight.airline }} - {{ flight.source }} to {{ flight.destination }}
                                ({{ flight.total_seats }} seats)
                            </option>
                        </select>
                    </div>
 
                    <div class="form-row">
                        <div class="form-group">
                            <label for="departure_time">Departure Time *</label>
                            <input type="datetime-local" id="departure_time" name="departure_time"
                                [(ngModel)]="currentSchedule.departure_time" required [disabled]="modalLoading" min={{datefront}}/>
                        </div>
 
                        <div class="form-group">
                            <label for="arrival_time">Arrival Time *</label>
                            <input type="datetime-local" id="arrival_time" name="arrival_time"
                                [(ngModel)]="currentSchedule.arrival_time" required [disabled]="modalLoading" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="price">Price *</label>
                        <input type="number" id="price" name="price"
                            [(ngModel)]="currentSchedule.price" required min="0"
                            placeholder="Price" [disabled]="modalLoading" />
                    </div>
 
                    <div class="form-group">
                        <label for="available_seats">Available Seats *</label>
                        <input type="number" id="available_seats" name="available_seats"
                            [(ngModel)]="currentSchedule.available_seats" required min="0"
                            placeholder="Number of available seats" [disabled]="modalLoading" />
                        <small *ngIf="currentSchedule.flight" class="helper-text">
                            Max seats for this flight:
                            {{ getFlightById(currentSchedule.flight)?.total_seats || 'N/A' }}
                        </small>
                    </div>
 
                    <div *ngIf="error" class="error-message">{{ error }}</div>
                </div>
 
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" (click)="closeModal()" [disabled]="modalLoading">
                        Cancel
                    </button>
                    <button type="submit" class="btn-save" [disabled]="modalLoading || !scheduleForm.valid">
                        <span *ngIf="modalLoading">Saving...</span>
                        <span *ngIf="!modalLoading">{{ isEditMode ? 'Update' : 'Create' }} Schedule</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>